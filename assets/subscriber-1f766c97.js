import{_ as m,M as l}from"./moqt_client_sample-0b69746b.js";const c="secret",i=()=>document.getElementById("form");function B(e){e.onSetup(async o=>{console.log({serverSetup:o})})}function g(e){document.getElementById("sendSetupBtn").addEventListener("click",async()=>{const a=i(),t=new BigUint64Array("0xff00000A".split(",").map(BigInt)),n=BigInt(a["max-subscribe-id"].value);await e.sendSetupMessage(t,n)})}function b(e){document.getElementById("sendSubscribeBtn").addEventListener("click",async()=>{const t=i()["subscribe-track-namespace"].value.split("/");r(e,"video",0),await e.sendSubscribeMessage(BigInt(0),BigInt(0),t,"video",0,0,1,BigInt(0),BigInt(0),BigInt(1e4),c),r(e,"audio",1),await e.sendSubscribeMessage(BigInt(1),BigInt(1),t,"audio",0,0,1,BigInt(0),BigInt(0),BigInt(1e4),c)})}const d=new Worker(new URL("/moq-wasm/assets/audioDecoder-4a97f5e3.js",self.location),{type:"module"});function f(){const e=new MediaStreamTrackGenerator({kind:"audio"}),o=e.writable.getWriter(),a=new MediaStream([e]),t=document.getElementById("audio");t.srcObject=a,d.onmessage=async n=>{const s=n.data.audioData;await o.write(s),await t.play()}}const u=new Worker(new URL("/moq-wasm/assets/videoDecoder-53d73955.js",self.location),{type:"module"});function w(){const e=new MediaStreamTrackGenerator({kind:"video"}),o=e.writable.getWriter(),a=new MediaStream([e]),t=document.getElementById("video");t.srcObject=a,u.onmessage=async n=>{const s=n.data.frame;await o.write(s),s.close(),await t.play()}}function r(e,o,a){e.onSubgroupStreamHeader(async t=>{}),o==="audio"?f():w(),e.onSubgroupStreamObject(BigInt(a),async(t,n)=>{if(o==="video"){if(n.objectPayloadLength===0||n.object_status==="EndOfGroup"||n.object_status==="EndOfTrackAndGroup"||n.object_status==="EndOfTrack")return;u.postMessage({groupId:t,subgroupStreamObject:n})}else d.postMessage({groupId:t,subgroupStreamObject:n})})}function k(e){g(e),b(e)}m().then(async()=>{document.getElementById("connectBtn").addEventListener("click",async()=>{const a=i().url.value,t=new l(a);B(t),k(t),await t.start()})});
