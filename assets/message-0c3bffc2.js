import{_ as W,M as _}from"./moqt_client_sample-098df381.js";W().then(async()=>{console.log("init wasm-pack");const b=new Set;let s=0n,o=0n,c=0n;document.getElementById("connectBtn").addEventListener("click",async()=>{const i=document.form.url.value,G=form["auth-info"].value,h=document.getElementById("received-text"),t=new _(i);console.log(t.id,t),console.log("URL:",t.url());const O=e=>{const n=document.createElement("br");h.prepend(n);const r=new Uint8Array(e),a=new TextDecoder().decode(r),d=document.createElement("p");d.textContent=a,h.prepend(d)};t.onSetup(async e=>{console.log({serverSetup:e})}),t.onAnnounce(async e=>{console.log({announceMessage:e});const n=e.track_namespace;await t.sendAnnounceOkMessage(n)}),t.onAnnounceResponce(async e=>{console.log({announceResponceMessage:e})}),t.onSubscribe(async(e,n,r)=>{console.log({subscribeMessage:e});const a=BigInt(e.subscribe_id),d=BigInt(e.track_alias);if(console.log("subscribeId",a,"trackAlias",d),n){const l=0n,m=Array.from(form["forwarding-preference"]).filter(p=>p.checked)[0].value;await t.sendSubscribeOkMessage(a,l,G,m)}else{const l="subscribe error";await t.sendSubscribeError(e.subscribe_id,r,l)}}),t.onSubscribeResponse(async e=>{console.log({subscribeResponse:e})}),t.onSubscribeAnnouncesResponse(async e=>{console.log({subscribeAnnouncesResponse:e})}),t.onUnsubscribe(async e=>{console.log({unsubscribeMessage:e})}),t.onDatagramObject(async e=>{console.log({datagramObject:e}),O(e.object_payload)}),t.onDatagramObjectStatus(async e=>{console.log({datagramObjectStatus:e})}),t.onSubgroupStreamHeader(async e=>{console.log({subgroupStreamHeader:e})});const L=form["subscribe-track-alias"].value;t.onSubgroupStreamObject(BigInt(L),async e=>{console.log({subgroupStreamObject:e});const n=e.object_payload;n.length>0&&O(n)});const u=document.getElementById("objectId"),A=document.getElementById("datagramGroupId"),x=document.getElementById("subgroupGroupId"),g=document.getElementById("subgroupId");document.getElementById("sendSetupBtn").addEventListener("click",async()=>{console.log("send setup btn clicked");const e=form.versions.value.split(",").map(BigInt),n=form["max-subscribe-id"].value;await t.sendSetupMessage(e,BigInt(n))}),document.getElementById("sendAnnounceBtn").addEventListener("click",async()=>{console.log("send announce btn clicked");const e=form["announce-track-namespace"].value.split("/"),n=form["auth-info"].value;await t.sendAnnounceMessage(e,n)}),document.getElementById("sendSubscribeAnnouncesBtn").addEventListener("click",async()=>{console.log("send subscribe announces btn clicked");const e=form["track-namespace-prefix"].value.split("/"),n=form["auth-info"].value;await t.sendSubscribeAnnouncesMessage(e,n)}),document.getElementById("sendSubscribeBtn").addEventListener("click",async()=>{console.log("send subscribe btn clicked");const e=form["subscribe-subscribe-id"].value,n=form["subscribe-track-alias"].value,r=form["subscribe-track-namespace"].value.split("/"),a=form["track-name"].value,d=form["subscriber-priority"].value,l=Array.from(form["group-order"]).filter(y=>y.checked)[0].value,m=Array.from(form["filter-type"]).filter(y=>y.checked)[0].value,p=form["start-group"].value,w=form["start-object"].value,C=form["end-group"].value,P=form["auth-info"].value;console.log(e,n,r,a,d,l,m,p,w,C),await t.sendSubscribeMessage(BigInt(e),BigInt(n),r,a,d,l,m,BigInt(p),BigInt(w),BigInt(C),P)}),document.getElementById("sendUnsubscribeBtn").addEventListener("click",async()=>{console.log("send unsubscribe btn clicked");const e=form["unsubscribe-subscribe-id"].value;await t.sendUnsubscribeMessage(e)}),document.getElementById("sendDatagramObjectBtn").addEventListener("click",async()=>{console.log("send datagram object btn clicked");const e=form["object-track-alias"].value,n=form["publisher-priority"].value,r=form["object-payload"].value,a=new TextEncoder().encode(r);await t.sendDatagramObject(BigInt(e),o,s++,n,a),u.textContent=s}),document.getElementById("sendDatagramObjectWithStatusBtn").addEventListener("click",async()=>{console.log("send datagram object with status btn clicked");const e=form["object-track-alias"].value,n=form["publisher-priority"].value,r=Array.from(form["object-status"]).filter(a=>a.checked)[0].value;await t.sendDatagramObjectStatus(BigInt(e),o,s++,n,r),u.textContent=s}),document.getElementById("sendSubgroupObjectBtn").addEventListener("click",async()=>{console.log("send subgroup stream object btn clicked");const e=form["object-track-alias"].value,n=form["publisher-priority"].value,r=form["object-payload"].value,a=new TextEncoder().encode(r),d=`${o}:${c}`;b.has(d)||(await t.sendSubgroupStreamHeaderMessage(BigInt(e),o,c,n),b.add(d)),await t.sendSubgroupStreamObject(BigInt(e),o,c,s++,void 0,a),u.textContent=s}),document.getElementById("sendSubgroupObjectWithStatusBtn").addEventListener("click",async()=>{console.log("send subgroup stream object with status btn clicked");const e=form["object-track-alias"].value,n=form["publisher-priority"].value,r=Array.from(form["object-status"]).filter(l=>l.checked)[0].value,a=Uint8Array.from([]),d=`${o}:${c}`;b.has(d)||(await t.sendSubgroupStreamHeaderMessage(BigInt(e),o,c,n),b.add(d)),await t.sendSubgroupStreamObject(BigInt(e),o,c,s++,r,a),u.textContent=s}),document.getElementById("ascendDatagramGroupIdBtn").addEventListener("click",async()=>{o++,s=0n,console.log("ascend groupId",o),A.textContent=o,u.textContent=s}),document.getElementById("descendDatagramGroupIdBtn").addEventListener("click",async()=>{o!==0n&&(o--,s=0n,console.log("descend groupId",o),A.textContent=o,u.textContent=s)}),document.getElementById("ascendSubgroupGroupIdBtn").addEventListener("click",async()=>{o++,c=0n,s=0n,console.log("ascend groupId",o),x.textContent=o,g.textContent=c,u.textContent=s}),document.getElementById("descendSubgroupGroupIdBtn").addEventListener("click",async()=>{o!==0n&&(o--,c=0n,s=0n,console.log("descend groupId",o),x.textContent=o,g.textContent=c,u.textContent=s)}),document.getElementById("ascendSubgroupIdBtn").addEventListener("click",async()=>{c++,s=0n,console.log("ascend subgroupId",c),g.textContent=c,u.textContent=s}),document.getElementById("descendSubgroupIdBtn").addEventListener("click",async()=>{c!==0n&&(c--,s=0n,console.log("descend subgroupId",c),g.textContent=c,u.textContent=s)}),await t.start()});const D=document.querySelectorAll('input[name="forwarding-preference"]'),I=document.getElementById("subgroupHeaderContents"),B=document.getElementById("datagramObjectContents"),f=document.getElementById("sendDatagramObject"),S=document.getElementById("sendDatagramObjectWithStatus"),k=document.getElementById("sendSubgroupObject"),v=document.getElementById("sendSubgroupObjectWithStatus"),E=document.getElementById("headerField"),j=document.getElementById("objectField");D.forEach(i=>{i.addEventListener("change",async()=>{i.value==="datagram"?(B.style.display="block",I.style.display="none",f.style.display="block",S.style.display="block",k.style.display="none",v.style.display="none",E.style.display="none",j.style.display="none"):i.value==="subgroup"&&(B.style.display="none",I.style.display="block",f.style.display="none",S.style.display="none",k.style.display="block",v.style.display="block",E.style.display="block",j.style.display="block")})})});
