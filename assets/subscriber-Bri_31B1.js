import{M as f}from"./moqtClient-DmrHV8BM.js";const d="secret",i=()=>document.getElementById("form"),s=new f,b=new Worker(new URL("/moq-wasm/assets/audioDecoder-Cs0Z2Bos.js",import.meta.url),{type:"module"}),y=new Worker(new URL("/moq-wasm/assets/videoDecoder-DfCSx2j3.js",import.meta.url),{type:"module"});let u=!1,l=!1;function p(t){const n=t.split(",").map(e=>e.trim()).filter(e=>e.length>0).map(e=>BigInt(e));return new BigUint64Array(n)}function w(){document.getElementById("sendSetupBtn").addEventListener("click",async()=>{const n=i(),e=p("0xff00000A"),a=BigInt(n["max-subscribe-id"].value);await s.sendSetupMessage(e,a)})}function g(){document.getElementById("sendSubscribeBtn").addEventListener("click",async()=>{const e=i()["subscribe-track-namespace"].value.split("/");m("video",0),await s.subscribe(0n,0n,e,"video",d),m("audio",1),await s.subscribe(1n,1n,e,"audio",d)})}function S(){if(u)return;u=!0;const t=new MediaStreamTrackGenerator({kind:"audio"}),n=t.writable.getWriter(),e=new MediaStream([t]),a=document.getElementById("audio");a.srcObject=e,b.onmessage=async o=>{const r=o.data;r.type==="audioData"&&(await n.ready,await n.write(r.audioData),await a.play())}}function B(){if(l)return;l=!0;const t=new MediaStreamTrackGenerator({kind:"video"}),n=t.writable.getWriter(),e=new MediaStream([t]),a=document.getElementById("video");a.srcObject=e,y.onmessage=async o=>{const r=o.data;if(r.type!=="frame")return;const c=r.frame;await n.ready,await n.write(c),c.close(),await a.play()}}function m(t,n){const e=BigInt(n);if(t==="audio"){S(),s.setOnSubgroupObjectHandler(e,(a,o)=>{const r=new Uint8Array(o.objectPayload);b.postMessage({groupId:a,subgroupStreamObject:{objectId:o.objectId,objectPayloadLength:o.objectPayloadLength,objectPayload:r,objectStatus:o.objectStatus}},[r.buffer])});return}B(),s.setOnSubgroupObjectHandler(e,(a,o)=>{const r=new Uint8Array(o.objectPayload);y.postMessage({groupId:a,subgroupStreamObject:{objectId:o.objectId,objectPayloadLength:o.objectPayloadLength,objectPayload:r,objectStatus:o.objectStatus}},[r.buffer])})}s.setOnServerSetupHandler(t=>{console.log({serverSetup:t})});const v=document.getElementById("connectBtn");v.addEventListener("click",async()=>{const n=i().url.value;await s.connect(n,{sendSetup:!1});const e=s.getRawClient();if(!e){console.error("MOQT client not connected");return}e.onSubgroupStreamHeader(async a=>{}),w(),g()});
