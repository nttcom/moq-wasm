(function(){"use strict";function i(e,o=1e3){let t=0,n=performance.now();return{addBytes(f){t+=f;const s=performance.now();if(s-n>=o){const g=t*8/1e3;e(g),t=0,n=s}}}}let a;const r={codec:"opus",sampleRate:48e3,numberOfChannels:1,bitrate:64e3},c=i(e=>{self.postMessage({type:"bitrate",media:"audio",kbps:e})});function d(e,o){c.addBytes(e.byteLength),console.debug("sendAudioChunkMessage",e,o),self.postMessage({type:"chunk",chunk:e,metadata:o})}async function u(){const e={output:d,error:t=>{console.log(t.message)}},o=new AudioEncoder(e);return o.configure(r),o}async function l(e){a||(a=await u());const o=e.getReader();for(;;){const t=await o.read();if(t.done)break;const n=t.value;a.encode(n),n.close()}}self.onmessage=async e=>{const o=e.data.audioStream;if(!o){console.error("MediaStreamTrack が渡されていません");return}await l(o)}})();
