var g=Object.defineProperty;var j=(a,r,c)=>r in a?g(a,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[r]=c;var f=(a,r,c)=>(j(a,typeof r!="symbol"?r+"":r,c),c);(function(){"use strict";class c{constructor(e=900){f(this,"buffer",[]);f(this,"minDelayMs",200);this.maxBufferSize=e}push(e,n,o){const s=performance.now(),i={groupId:e,objectId:n,timestamp:s,object:o},m=this.findInsertPos(e,n);this.buffer.splice(m,0,i),this.buffer.length>this.maxBufferSize&&(console.warn("JitterBuffer is full, removing the oldest element"),this.buffer.shift())}pop(){if(this.buffer.length===0)return null;const e=this.buffer[0];return performance.now()-e.timestamp<this.minDelayMs?null:(this.buffer.shift(),e.object)}findInsertPos(e,n){for(let o=this.buffer.length-1;o>=0;o--){const s=this.buffer[o];if(s.groupId===e&&s.objectId<n||s.groupId<e)return o+1}return 0}}function b(t){self.postMessage({audioData:t}),t.close()}let u;async function l(){const t={output:b,error:o=>{console.log(o.message)}},e={codec:"opus",sampleRate:48e3,numberOfChannels:1,bitrate:64e3},n=new AudioDecoder(t);return n.configure(e),n}const h=10,d=new c;setInterval(()=>{const t=d.pop();t&&p(t)},h),self.onmessage=async t=>{const e={objectId:t.data.subgroupStreamObject.object_id,objectPayloadLength:t.data.subgroupStreamObject.object_payload_length,objectPayload:t.data.subgroupStreamObject.object_payload,objectStatus:t.data.subgroupStreamObject.object_status};d.push(t.data.groupId,e.objectId,e)};async function p(t){const e=new Uint8Array(t.objectPayload),o=new TextDecoder().decode(e),s=JSON.parse(o),i=new EncodedAudioChunk({type:s.chunk.type,timestamp:s.chunk.timestamp,duration:s.chunk.duration,data:new Uint8Array(s.chunk.data)});u||(u=await l()),await u.decode(i)}})();
