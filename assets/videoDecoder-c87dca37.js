var w=Object.defineProperty;var S=(i,r,c)=>r in i?w(i,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):i[r]=c;var d=(i,r,c)=>(S(i,typeof r!="symbol"?r+"":r,c),c);(function(){"use strict";class c{constructor(t=1800){d(this,"buffer",[]);d(this,"minDelayMs",500);this.maxBufferSize=t}push(t,o,s){const n=performance.now(),u={groupId:t,objectId:o,timestamp:n,object:s},f=this.findInsertPos(t,o);this.buffer.splice(f,0,u),this.buffer.length>this.maxBufferSize&&(console.warn("JitterBuffer is full, removing the oldest element"),this.buffer.shift())}pop(){if(this.buffer.length===0)return null;const t=this.buffer[0];return performance.now()-t.timestamp<this.minDelayMs?null:(this.buffer.shift(),t.object)}findInsertPos(t,o){for(let s=this.buffer.length-1;s>=0;s--){const n=this.buffer[s];if(n.groupId===t&&n.objectId<o||n.groupId<t)return s+1}return 0}}function l(e){const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0),s=e.slice(4,4+o),n=new TextDecoder().decode(s),u=JSON.parse(n),f=e.slice(4+o);return{meta:u,chunkArray:f}}function m(){let e=0,t=performance.now();return{addBytes(o){e+=o;const s=performance.now();if(s-t>=1e3){const n=e*8/1e6;console.log(`Received bitrate: ${n.toFixed(2)} Mbps`),e=0,t=s}}}}const h=m();function p(e){self.postMessage({frame:e}),e.close()}let a;const g={codec:"av01.0.08M.08",width:1920,height:1080,scalabilityMode:"L1T1"};async function y(){const e={output:p,error:o=>{console.log(o.message),a=void 0}},t=new VideoDecoder(e);return await t.configure(g),t}const _=5,b=new c;setInterval(()=>{const e=b.pop();e&&j(e)},_),self.onmessage=async e=>{const t=e.data.subgroupStreamObject.object_payload_length;h.addBytes(t);const o={objectId:e.data.subgroupStreamObject.object_id,objectPayloadLength:e.data.subgroupStreamObject.object_payload_length,objectPayload:new Uint8Array(e.data.subgroupStreamObject.object_payload),objectStatus:e.data.subgroupStreamObject.object_status};b.push(e.data.groupId,o.objectId,o)};async function j(e){const{meta:t,chunkArray:o}=l(e.objectPayload),s=new EncodedVideoChunk({type:t.type,timestamp:t.timestamp,duration:t.duration,data:o});!a&&(a=await y(),t.type!=="key")||await a.decode(s)}})();
