import{M}from"./moqtClient-bBn0xwEM.js";const g=new M,I=new Set;let a=0n,u=0n,l=0n;function T(){const s=document.forms.namedItem("form");if(!s)throw new Error("form element not found");return s}function o(s,e){const c=s.elements.namedItem(e);if(c instanceof HTMLInputElement||c instanceof HTMLTextAreaElement)return c;const t=document.getElementById(e);if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)return t;throw new Error(`input "${e}" not found`)}function S(s,e){const c=s.elements.namedItem(e);if(!c)return"";if(c instanceof RadioNodeList)return c.value;if(c instanceof HTMLInputElement&&c.type==="radio")return c.checked?c.value:"";throw new Error(`radio group "${e}" not found`)}function N(s){const e=s.split(",").map(c=>c.trim()).filter(c=>c.length>0).map(c=>BigInt(c));return new BigUint64Array(e)}function G(s,e){const c=document.createElement("br");e.prepend(c);const t=s instanceof Uint8Array?s:new Uint8Array(s),i=new TextDecoder().decode(t),n=document.createElement("p");n.textContent=i,e.prepend(n)}function U(){const s=document.getElementById("connectBtn");s instanceof HTMLButtonElement&&s.addEventListener("click",async()=>{const e=T(),c=o(e,"url").value,t=document.getElementById("received-text");if(!t)return;await g.connect(c,{sendSetup:!1});const i=g.getRawClient();if(!i){console.error("MOQT client connection is not available");return}g.setOnServerSetupHandler(n=>{console.log({serverSetup:n})}),g.setOnAnnounceHandler(async n=>{console.log({announceMessage:n}),await i.sendAnnounceOkMessage(n.trackNamespace)}),g.setOnSubscribeResponseHandler(n=>{console.log({subscribeResponse:n})}),g.setOnIncomingSubscribeHandler(async({subscribe:n,isSuccess:b,code:E,respondOk:k,respondError:j})=>{console.log({subscribeMessage:n});const f=o(e,"auth-info").value,w=S(e,"forwarding-preference");b?await k(0n,f,w):await j(BigInt(E),"subscribe error")}),i.onAnnounceResponse(n=>{console.log({announceResponseMessage:n})}),i.onSubscribeAnnouncesResponse(n=>{console.log({subscribeAnnouncesResponse:n})}),i.onUnsubscribe(n=>{console.log({unsubscribeMessage:n})}),i.onDatagramObject(n=>{console.log({datagramObject:n});const b=n.objectPayload??n.object_payload;b&&G(b,t)}),i.onDatagramObjectStatus(n=>{console.log({datagramObjectStatus:n})}),i.onSubgroupStreamHeader(n=>{console.log({subgroupStreamHeader:n})}),W(i,e,t)})}function R(){const s=document.getElementById("closeBtn");s instanceof HTMLButtonElement&&s.addEventListener("click",async()=>{await g.disconnect(),I.clear(),a=0n,u=0n,l=0n})}function W(s,e,c){const t=document.getElementById("objectId"),i=document.getElementById("datagramGroupId"),n=document.getElementById("subgroupGroupId"),b=document.getElementById("subgroupId");document.getElementById("sendSetupBtn")?.addEventListener("click",async()=>{console.log("send setup btn clicked");const r=o(e,"versions").value,d=BigInt(o(e,"max-subscribe-id").value);await g.sendSetupMessage(N(r),d)}),document.getElementById("sendAnnounceBtn")?.addEventListener("click",async()=>{console.log("send announce btn clicked");const r=o(e,"announce-track-namespace").value.split("/").filter(Boolean),d=o(e,"auth-info").value;await g.announce(r,d)}),document.getElementById("sendSubscribeAnnouncesBtn")?.addEventListener("click",async()=>{console.log("send subscribe announces btn clicked");const r=o(e,"track-namespace-prefix").value.split("/").filter(Boolean),d=o(e,"auth-info").value;await g.subscribeAnnounces(r,d)}),document.getElementById("sendSubscribeBtn")?.addEventListener("click",async()=>{console.log("send subscribe btn clicked");const r=BigInt(o(e,"subscribe-subscribe-id").value),d=BigInt(o(e,"subscribe-track-alias").value),p=o(e,"subscribe-track-namespace").value.split("/").filter(Boolean),m=o(e,"track-name").value,B=o(e,"subscriber-priority").value,x=S(e,"group-order"),A=S(e,"filter-type"),L=BigInt(o(e,"start-group").value),O=BigInt(o(e,"start-object").value),C=BigInt(o(e,"end-group").value),P=o(e,"auth-info").value;console.log(r,d,p,m,B,x,A,L,O,C),g.setOnSubgroupObjectHandler(d,(D,y)=>{console.log({groupId:D,subgroupStreamObject:y});const H=y.object_payload,v=y.objectPayload??H;v&&v.length>0&&G(v,c)}),await s.sendSubscribeMessage(r,d,p,m,Number(B),Number(x),Number(A),L,O,C,P)}),document.getElementById("sendUnsubscribeBtn")?.addEventListener("click",async()=>{console.log("send unsubscribe btn clicked");const r=o(e,"unsubscribe-subscribe-id").value;await s.sendUnsubscribeMessage(BigInt(r))}),document.getElementById("sendDatagramObjectBtn")?.addEventListener("click",async()=>{console.log("send datagram object btn clicked");const r=BigInt(o(e,"object-track-alias").value),d=Number(o(e,"publisher-priority").value),p=o(e,"object-payload").value,m=new TextEncoder().encode(p);await s.sendDatagramObject(r,u,a++,d,m),t&&(t.textContent=a.toString())}),document.getElementById("sendDatagramObjectWithStatusBtn")?.addEventListener("click",async()=>{console.log("send datagram object with status btn clicked");const r=BigInt(o(e,"object-track-alias").value),d=Number(o(e,"publisher-priority").value),p=Number(S(e,"object-status"));await s.sendDatagramObjectStatus(r,u,a++,d,p),t&&(t.textContent=a.toString())}),document.getElementById("sendSubgroupObjectBtn")?.addEventListener("click",async()=>{console.log("send subgroup stream object btn clicked");const r=BigInt(o(e,"object-track-alias").value),d=Number(o(e,"publisher-priority").value),p=o(e,"object-payload").value,m=new TextEncoder().encode(p),B=`${u}:${l}`;I.has(B)||(await s.sendSubgroupStreamHeaderMessage(r,u,l,d),I.add(B)),await s.sendSubgroupStreamObject(r,u,l,a++,void 0,m,void 0),t&&(t.textContent=a.toString())}),document.getElementById("sendSubgroupObjectWithStatusBtn")?.addEventListener("click",async()=>{console.log("send subgroup stream object with status btn clicked");const r=BigInt(o(e,"object-track-alias").value),d=Number(o(e,"publisher-priority").value),p=Number(S(e,"object-status")),m=new Uint8Array,B=`${u}:${l}`;I.has(B)||(await s.sendSubgroupStreamHeaderMessage(r,u,l,d),I.add(B)),await s.sendSubgroupStreamObject(r,u,l,a++,p,m,void 0),t&&(t.textContent=a.toString())}),document.getElementById("ascendDatagramGroupIdBtn")?.addEventListener("click",()=>{u++,a=0n,i&&(i.textContent=u.toString()),t&&(t.textContent=a.toString())}),document.getElementById("descendDatagramGroupIdBtn")?.addEventListener("click",()=>{u!==0n&&(u--,a=0n,i&&(i.textContent=u.toString()),t&&(t.textContent=a.toString()))}),document.getElementById("ascendSubgroupGroupIdBtn")?.addEventListener("click",()=>{u++,l=0n,a=0n,n&&(n.textContent=u.toString()),b&&(b.textContent=l.toString()),t&&(t.textContent=a.toString())}),document.getElementById("descendSubgroupGroupIdBtn")?.addEventListener("click",()=>{u!==0n&&(u--,l=0n,a=0n,n&&(n.textContent=u.toString()),b&&(b.textContent=l.toString()),t&&(t.textContent=a.toString()))}),document.getElementById("ascendSubgroupIdBtn")?.addEventListener("click",()=>{l++,a=0n,b&&(b.textContent=l.toString()),t&&(t.textContent=a.toString())}),document.getElementById("descendSubgroupIdBtn")?.addEventListener("click",()=>{l!==0n&&(l--,a=0n,b&&(b.textContent=l.toString()),t&&(t.textContent=a.toString()))})}U();R();
