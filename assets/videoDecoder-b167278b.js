var _=Object.defineProperty;var g=(a,n,c)=>n in a?_(a,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[n]=c;var d=(a,n,c)=>(g(a,typeof n!="symbol"?n+"":n,c),c);(function(){"use strict";class c{constructor(e=300){d(this,"buffer",[]);d(this,"minDelayMs",200);this.maxBufferSize=e}push(e,s,r){const o=performance.now(),u={groupId:e,objectId:s,timestamp:o,object:r},y=this.findInsertPos(e,s);this.buffer.splice(y,0,u),this.buffer.length>this.maxBufferSize&&(console.warn("JitterBuffer is full, removing the oldest element"),this.buffer.shift())}pop(){if(this.buffer.length===0)return null;const e=this.buffer[0];return performance.now()-e.timestamp<this.minDelayMs?null:(this.buffer.shift(),e.object)}findInsertPos(e,s){for(let r=this.buffer.length-1;r>=0;r--){const o=this.buffer[r];if(o.groupId===e&&o.objectId<s||o.groupId<e)return r+1}return 0}}function b(t){self.postMessage({frame:t}),t.close()}let i;const l={codec:"avc1.640028",avc:{format:"annexb"},hardwareAcceleration:"prefer-hardware",width:1920,height:1080,scalabilityMode:"L1T1"};async function h(){const t={output:b,error:s=>{console.log(s.message),i=void 0}},e=new VideoDecoder(t);return await e.configure(l),e}const p=15,f=new c;setInterval(()=>{const t=f.pop();t&&m(t)},p),self.onmessage=async t=>{const e={objectId:t.data.subgroupStreamObject.object_id,objectPayloadLength:t.data.subgroupStreamObject.object_payload_length,objectPayload:t.data.subgroupStreamObject.object_payload,objectStatus:t.data.subgroupStreamObject.object_status};f.push(t.data.groupId,e.objectId,e)};async function m(t){const e=new Uint8Array(t.objectPayload),r=new TextDecoder().decode(e),o=JSON.parse(r),u=new EncodedVideoChunk({type:o.chunk.type,timestamp:o.chunk.timestamp,duration:o.chunk.duration,data:new Uint8Array(o.chunk.data)});!i&&(i=await h(),o.chunk.type!=="key")||await i.decode(u)}})();
