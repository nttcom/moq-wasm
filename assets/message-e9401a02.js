import{M as Q}from"./moqtClient-9749a8f2.js";const g=new Q,f=new Set;let a=0n,i=0n,d=0n;function V(){const c=document.forms.namedItem("form");if(!c)throw new Error("form element not found");return c}function o(c,e){const s=c.elements.namedItem(e);if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement)return s;const t=document.getElementById(e);if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)return t;throw new Error(`input "${e}" not found`)}function w(c,e){const s=c.elements.namedItem(e);if(!s)return"";if(s instanceof RadioNodeList)return s.value;if(s instanceof HTMLInputElement&&s.type==="radio")return s.checked?s.value:"";throw new Error(`radio group "${e}" not found`)}function W(c){const e=c.split(",").map(s=>s.trim()).filter(s=>s.length>0).map(s=>BigInt(s));return new BigUint64Array(e)}function D(c,e){const s=document.createElement("br");e.prepend(s);const t=c instanceof Uint8Array?c:new Uint8Array(c),u=new TextDecoder().decode(t),n=document.createElement("p");n.textContent=u,e.prepend(n)}function z(){const c=document.getElementById("connectBtn");c instanceof HTMLButtonElement&&c.addEventListener("click",async()=>{const e=V(),s=o(e,"url").value,t=document.getElementById("received-text");if(!t)return;await g.connect(s,{sendSetup:!1});const u=g.getRawClient();if(!u){console.error("MOQT client connection is not available");return}g.setOnServerSetupHandler(n=>{console.log({serverSetup:n})}),g.setOnAnnounceHandler(async n=>{console.log({announceMessage:n}),await u.sendAnnounceOkMessage(n.trackNamespace)}),g.setOnSubscribeResponseHandler(n=>{console.log({subscribeResponse:n})}),g.setOnIncomingSubscribeHandler(async({subscribe:n,isSuccess:b,code:E,respondOk:v,respondError:B})=>{console.log({subscribeMessage:n});const k=o(e,"auth-info").value,S=w(e,"forwarding-preference");if(b)await v(0n,k,S);else{const I="subscribe error";await B(BigInt(E),I)}}),u.onAnnounceResponse(n=>{console.log({announceResponseMessage:n})}),u.onSubscribeAnnouncesResponse(n=>{console.log({subscribeAnnouncesResponse:n})}),u.onUnsubscribe(n=>{console.log({unsubscribeMessage:n})}),u.onDatagramObject(n=>{console.log({datagramObject:n});const b=n.objectPayload??n.object_payload;b&&D(b,t)}),u.onDatagramObjectStatus(n=>{console.log({datagramObjectStatus:n})}),u.onSubgroupStreamHeader(n=>{console.log({subgroupStreamHeader:n})}),K(u,e,t)})}function J(){const c=document.getElementById("closeBtn");c instanceof HTMLButtonElement&&c.addEventListener("click",async()=>{await g.disconnect(),f.clear(),a=0n,i=0n,d=0n})}function K(c,e,s){const t=document.getElementById("objectId"),u=document.getElementById("datagramGroupId"),n=document.getElementById("subgroupGroupId"),b=document.getElementById("subgroupId"),E=document.getElementById("sendSetupBtn");E==null||E.addEventListener("click",async()=>{console.log("send setup btn clicked");const r=o(e,"versions").value,l=BigInt(o(e,"max-subscribe-id").value);await g.sendSetupMessage(W(r),l)});const v=document.getElementById("sendAnnounceBtn");v==null||v.addEventListener("click",async()=>{console.log("send announce btn clicked");const r=o(e,"announce-track-namespace").value.split("/").filter(Boolean),l=o(e,"auth-info").value;await g.announce(r,l)});const B=document.getElementById("sendSubscribeAnnouncesBtn");B==null||B.addEventListener("click",async()=>{console.log("send subscribe announces btn clicked");const r=o(e,"track-namespace-prefix").value.split("/").filter(Boolean),l=o(e,"auth-info").value;await g.subscribeAnnounces(r,l)});const k=document.getElementById("sendSubscribeBtn");k==null||k.addEventListener("click",async()=>{console.log("send subscribe btn clicked");const r=BigInt(o(e,"subscribe-subscribe-id").value),l=BigInt(o(e,"subscribe-track-alias").value),m=o(e,"subscribe-track-namespace").value.split("/").filter(Boolean),p=o(e,"track-name").value,y=o(e,"subscriber-priority").value,O=w(e,"group-order"),R=w(e,"filter-type"),U=BigInt(o(e,"start-group").value),G=BigInt(o(e,"start-object").value),$=BigInt(o(e,"end-group").value),q=o(e,"auth-info").value;console.log(r,l,m,p,y,O,R,U,G,$),g.setOnSubgroupObjectHandler(l,(F,T)=>{console.log({groupId:F,subgroupStreamObject:T});const _=T.object_payload,N=T.objectPayload??_;N&&N.length>0&&D(N,s)}),await c.sendSubscribeMessage(r,l,m,p,Number(y),Number(O),Number(R),U,G,$,q)});const S=document.getElementById("sendUnsubscribeBtn");S==null||S.addEventListener("click",async()=>{console.log("send unsubscribe btn clicked");const r=o(e,"unsubscribe-subscribe-id").value;await c.sendUnsubscribeMessage(BigInt(r))});const I=document.getElementById("sendDatagramObjectBtn");I==null||I.addEventListener("click",async()=>{console.log("send datagram object btn clicked");const r=BigInt(o(e,"object-track-alias").value),l=Number(o(e,"publisher-priority").value),m=o(e,"object-payload").value,p=new TextEncoder().encode(m);await c.sendDatagramObject(r,i,a++,l,p),t&&(t.textContent=a.toString())});const j=document.getElementById("sendDatagramObjectWithStatusBtn");j==null||j.addEventListener("click",async()=>{console.log("send datagram object with status btn clicked");const r=BigInt(o(e,"object-track-alias").value),l=Number(o(e,"publisher-priority").value),m=Number(w(e,"object-status"));await c.sendDatagramObjectStatus(r,i,a++,l,m),t&&(t.textContent=a.toString())});const x=document.getElementById("sendSubgroupObjectBtn");x==null||x.addEventListener("click",async()=>{console.log("send subgroup stream object btn clicked");const r=BigInt(o(e,"object-track-alias").value),l=Number(o(e,"publisher-priority").value),m=o(e,"object-payload").value,p=new TextEncoder().encode(m),y=`${i}:${d}`;f.has(y)||(await c.sendSubgroupStreamHeaderMessage(r,i,d,l),f.add(y)),await c.sendSubgroupStreamObject(r,i,d,a++,void 0,p),t&&(t.textContent=a.toString())});const h=document.getElementById("sendSubgroupObjectWithStatusBtn");h==null||h.addEventListener("click",async()=>{console.log("send subgroup stream object with status btn clicked");const r=BigInt(o(e,"object-track-alias").value),l=Number(o(e,"publisher-priority").value),m=Number(w(e,"object-status")),p=new Uint8Array,y=`${i}:${d}`;f.has(y)||(await c.sendSubgroupStreamHeaderMessage(r,i,d,l),f.add(y)),await c.sendSubgroupStreamObject(r,i,d,a++,m,p),t&&(t.textContent=a.toString())});const L=document.getElementById("ascendDatagramGroupIdBtn");L==null||L.addEventListener("click",()=>{i++,a=0n,u&&(u.textContent=i.toString()),t&&(t.textContent=a.toString())});const C=document.getElementById("descendDatagramGroupIdBtn");C==null||C.addEventListener("click",()=>{i!==0n&&(i--,a=0n,u&&(u.textContent=i.toString()),t&&(t.textContent=a.toString()))});const A=document.getElementById("ascendSubgroupGroupIdBtn");A==null||A.addEventListener("click",()=>{i++,d=0n,a=0n,n&&(n.textContent=i.toString()),b&&(b.textContent=d.toString()),t&&(t.textContent=a.toString())});const P=document.getElementById("descendSubgroupGroupIdBtn");P==null||P.addEventListener("click",()=>{i!==0n&&(i--,d=0n,a=0n,n&&(n.textContent=i.toString()),b&&(b.textContent=d.toString()),t&&(t.textContent=a.toString()))});const H=document.getElementById("ascendSubgroupIdBtn");H==null||H.addEventListener("click",()=>{d++,a=0n,b&&(b.textContent=d.toString()),t&&(t.textContent=a.toString())});const M=document.getElementById("descendSubgroupIdBtn");M==null||M.addEventListener("click",()=>{d!==0n&&(d--,a=0n,b&&(b.textContent=d.toString()),t&&(t.textContent=a.toString()))})}z();J();
