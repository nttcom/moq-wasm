var B=Object.defineProperty;var p=(t,e,n)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var u=(t,e,n)=>(p(t,typeof e!="symbol"?e+"":e,n),n);import{_ as g,M as w}from"./moqt_client_sample-0b69746b.js";const d="secret",c=()=>document.getElementById("form"),y=300;class I{constructor(e,n=y){u(this,"buffer",[]);this.minDelayMs=e,this.maxBufferSize=n}push(e,n,s){const o=performance.now(),r={groupId:e,objectId:n,timestamp:o,object:s},i=this.findInsertPos(e,n);this.buffer.splice(i,0,r),this.buffer.length>this.maxBufferSize&&(console.warn("JitterBuffer is full, removing the oldest element"),this.buffer.shift())}pop(){if(this.buffer.length===0)return null;const e=this.buffer[0];return performance.now()-e.timestamp<this.minDelayMs?null:(this.buffer.shift(),e.object)}findInsertPos(e,n){for(let s=this.buffer.length-1;s>=0;s--){const o=this.buffer[s];if(o.groupId===e&&o.objectId<n||o.groupId<e)return s+1}return 0}}function h(t){t.onSetup(async e=>{console.log({serverSetup:e})})}function v(t){document.getElementById("sendSetupBtn").addEventListener("click",async()=>{const n=c(),s=new BigUint64Array("0xff00000A".split(",").map(BigInt)),o=BigInt(n["max-subscribe-id"].value);await t.sendSetupMessage(s,o)})}function S(t){document.getElementById("sendSubscribeBtn").addEventListener("click",async()=>{const n=c(),s=n["subscribe-track-namespace"].value.split("/");l(t,"video",0),await t.sendSubscribeMessage(BigInt(0),BigInt(0),s,"video",0,0,1,BigInt(0),BigInt(0),BigInt(1e4),d),l(t,"audio",1),await t.sendSubscribeMessage(BigInt(1),BigInt(1),s,"audio",0,0,1,BigInt(0),BigInt(0),BigInt(1e4),d),n["jitter-buffer-delay"].disabled=!0})}const m=new Worker(new URL("/moq-wasm/assets/audioDecoder-0786b75b.js",self.location),{type:"module"});function k(){const t=new MediaStreamTrackGenerator({kind:"audio"}),e=t.writable.getWriter(),n=new MediaStream([t]),s=document.getElementById("audio");s.srcObject=n,m.onmessage=async o=>{const r=o.data.audioData;await e.write(r),await s.play()}}const b=new Worker(new URL("/moq-wasm/assets/videoDecoder-2badff97.js",self.location),{type:"module"});function E(){const t=new MediaStreamTrackGenerator({kind:"video"}),e=t.writable.getWriter(),n=new MediaStream([t]),s=document.getElementById("video");s.srcObject=n,b.onmessage=async o=>{const r=o.data.frame;await e.write(r),r.close(),await s.play()}}function f(t,e,n){setInterval(()=>{const s=e.pop();s&&t.postMessage({subgroupStreamObject:s})},n)}function l(t,e,n){t.onSubgroupStreamHeader(async i=>{});const o=c()["jitter-buffer-delay"].value.split("/").map(i=>Number.parseFloat(i)),r=new I(o);e==="audio"?(k(),f(m,r,10)):(E(),f(b,r,15)),t.onSubgroupStreamObject(BigInt(n),async(i,a)=>{e==="video"&&(a.objectPayloadLength===0||a.object_status==="EndOfGroup"||a.object_status==="EndOfTrackAndGroup"||a.object_status==="EndOfTrack")||r.push(i,a.object_id,a)})}function M(t){v(t),S(t)}g().then(async()=>{document.getElementById("connectBtn").addEventListener("click",async()=>{const n=c().url.value,s=new w(n);h(s),M(s),await s.start()})});
