(function(){"use strict";let a,n;const i={codec:"avc1.640028",avc:{format:"annexb"},hardwareAcceleration:"prefer-hardware",width:1920,height:1080,bitrate:15e6,scalabilityMode:"L1T1",framerate:30,latencyMode:"realtime"};function d(e,o){self.postMessage({chunk:e,metadata:o})}async function s(){const e={output:d,error:r=>{console.log(r.message)}};console.log("isEncoderConfig Supported",await VideoEncoder.isConfigSupported(i));const o=new VideoEncoder(e);return o.configure(i),o}async function l(e){let o=0;a||(a=await s());const r=e.getReader();for(;;){const c=await r.read();if(c.done)break;const t=c.value;if(a.encodeQueueSize>10)console.error("videoEncoder.encodeQueueSize > 10",a.encodeQueueSize),t.close();else{const u=o%n==0;a.encode(t,{keyFrame:u}),o++,t.close()}}}self.onmessage=async e=>{if(e.data.type==="keyframeInterval")n=e.data.keyframeInterval;else if(e.data.type==="videoStream"){const o=e.data.videoStream;if(!o){console.error("MediaStreamTrack が渡されていません");return}await l(o)}}})();
