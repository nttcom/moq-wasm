(function(){"use strict";function i(e,t=1e3){let o=0,a=performance.now();return{addBytes(f){o+=f;const s=performance.now();if(s-a>=t){const g=o*8/1e3;e(g),o=0,a=s}}}}let n;const r={codec:"opus",sampleRate:48e3,numberOfChannels:1,bitrate:64e3},c=i(e=>{self.postMessage({type:"bitrate",media:"audio",kbps:e})});function d(e,t){c.addBytes(e.byteLength),self.postMessage({type:"chunk",chunk:e,metadata:t})}async function u(){const e={output:d,error:o=>{console.log(o.message)}},t=new AudioEncoder(e);return t.configure(r),t}async function l(e){n||(n=await u());const t=e.getReader();for(;;){const o=await t.read();if(o.done)break;const a=o.value;n.encode(a),a.close()}}self.onmessage=async e=>{const t=e.data.audioStream;if(!t){console.error("MediaStreamTrack が渡されていません");return}await l(t)}})();
