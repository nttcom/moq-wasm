import{M as f}from"./moqtClient-9749a8f2.js";const d="secret",s=()=>document.getElementById("form"),c=new f,b=new Worker(new URL("/moq-wasm/assets/audioDecoder-cdce80ce.js",self.location),{type:"module"}),y=new Worker(new URL("/moq-wasm/assets/videoDecoder-6065252b.js",self.location),{type:"module"});let u=!1,l=!1;function w(t){const n=t.split(",").map(e=>e.trim()).filter(e=>e.length>0).map(e=>BigInt(e));return new BigUint64Array(n)}function p(){document.getElementById("sendSetupBtn").addEventListener("click",async()=>{const n=s(),e=w("0xff00000A"),a=BigInt(n["max-subscribe-id"].value);await c.sendSetupMessage(e,a)})}function g(){document.getElementById("sendSubscribeBtn").addEventListener("click",async()=>{const e=s()["subscribe-track-namespace"].value.split("/");m("video",0),await c.subscribe(0n,0n,e,"video",d),m("audio",1),await c.subscribe(1n,1n,e,"audio",d)})}function S(){if(u)return;u=!0;const t=new MediaStreamTrackGenerator({kind:"audio"}),n=t.writable.getWriter(),e=new MediaStream([t]),a=document.getElementById("audio");a.srcObject=e,b.onmessage=async o=>{const r=o.data;r.type==="audioData"&&(await n.ready,await n.write(r.audioData),await a.play())}}function v(){if(l)return;l=!0;const t=new MediaStreamTrackGenerator({kind:"video"}),n=t.writable.getWriter(),e=new MediaStream([t]),a=document.getElementById("video");a.srcObject=e,y.onmessage=async o=>{const r=o.data;if(r.type!=="frame")return;const i=r.frame;await n.ready,await n.write(i),i.close(),await a.play()}}function m(t,n){const e=BigInt(n);if(t==="audio"){S(),c.setOnSubgroupObjectHandler(e,(a,o)=>{const r=new Uint8Array(o.objectPayload);b.postMessage({groupId:a,subgroupStreamObject:{objectId:o.objectId,objectPayloadLength:o.objectPayloadLength,objectPayload:r,objectStatus:o.objectStatus}},[r.buffer])});return}v(),c.setOnSubgroupObjectHandler(e,(a,o)=>{const r=new Uint8Array(o.objectPayload);y.postMessage({groupId:a,subgroupStreamObject:{objectId:o.objectId,objectPayloadLength:o.objectPayloadLength,objectPayload:r,objectStatus:o.objectStatus}},[r.buffer])})}c.setOnServerSetupHandler(t=>{console.log({serverSetup:t})});const B=document.getElementById("connectBtn");B.addEventListener("click",async()=>{const n=s().url.value;await c.connect(n,{sendSetup:!1});const e=c.getRawClient();if(!e){console.error("MOQT client not connected");return}e.onSubgroupStreamHeader(async a=>{}),p(),g()});
